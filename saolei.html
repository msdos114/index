<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM-MS-DOSçš„ä¸ªäººç½‘ç«™</title>
    <div id="top">
        <img src="./top.png">
    </div>
</head>
<body>
    <!-- æ ‡é¢˜æ  -->
    <div class="navbar">
        <a href="./index/index.html">é¦–é¡µ</a>
        <a href="./index/1.html">ä¸‹è½½æ–‡ä»¶</a>
        <a href="./index/2.html">è”ç³»æˆ‘</a>
        <a href="./index/3.html">ä½œå“</a>
    </div>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#FF7D00',
                        neutral: '#E0E0E0',
                        dark: '#333333',
                        light: '#F5F5F5'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .cell-unrevealed {
                @apply bg-neutral border-2 border-t-white border-l-white border-r-gray-600 border-b-gray-600 cursor-pointer transition-all duration-150 hover:bg-gray-300;
            }
            .cell-revealed {
                @apply bg-gray-300 border border-gray-500;
            }
            .btn-pressed {
                @apply bg-gray-400 border border-gray-600 shadow-inner;
            }
            .text-1 { color: #0000FF; }
            .text-2 { color: #008000; }
            .text-3 { color: #FF0000; }
            .text-4 { color: #000080; }
            .text-5 { color: #800000; }
            .text-6 { color: #008080; }
            .text-7 { color: #000000; }
            .text-8 { color: #808080; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-light to-neutral min-h-screen flex flex-col items-center justify-center p-4 font-sans">
    <div class="max-w-md w-full bg-white rounded-xl shadow-2xl overflow-hidden border-4 border-t-gray-200 border-l-gray-200 border-r-gray-700 border-b-gray-700">
        <!-- æ¸¸æˆæ ‡é¢˜ -->
        <div class="bg-primary text-white text-center py-3 px-4 border-b-4 border-gray-700">
            <h1 class="text-xl font-bold flex items-center justify-center gap-2">
                <i class="fa fa-bomb"></i> ç»å…¸æ‰«é›·
            </h1>
        </div>
        
        <!-- æ¸¸æˆçŠ¶æ€æ  -->
        <div class="bg-gray-200 p-3 flex justify-between items-center border-b-4 border-gray-700">
            <div class="bg-black text-red-500 text-2xl font-mono px-2 py-1 rounded flex items-center justify-center w-16 h-10 shadow-inner">
                <span id="mine-counter">000</span>
            </div>
            
            <button id="reset-btn" class="w-10 h-10 bg-neutral text-2xl flex items-center justify-center rounded border-2 border-t-white border-l-white border-r-gray-600 border-b-gray-600 hover:bg-gray-300 transition-all duration-150">
                ğŸ˜Š
            </button>
            
            <div class="bg-black text-red-500 text-2xl font-mono px-2 py-1 rounded flex items-center justify-center w-16 h-10 shadow-inner">
                <span id="timer">000</span>
            </div>
        </div>
        
        <!-- æ¸¸æˆéš¾åº¦é€‰æ‹© -->
        <div class="bg-gray-100 p-3 border-b-4 border-gray-700">
            <div class="flex justify-between gap-2">
                <button class="difficulty-btn flex-1 py-2 px-3 bg-neutral rounded border-2 border-t-white border-l-white border-r-gray-600 border-b-gray-600 hover:bg-gray-300 transition-all duration-150 text-sm font-medium" data-rows="9" data-cols="9" data-mines="10">
                    åˆçº§
                </button>
                <button class="difficulty-btn flex-1 py-2 px-3 bg-neutral rounded border-2 border-t-white border-l-white border-r-gray-600 border-b-gray-600 hover:bg-gray-300 transition-all duration-150 text-sm font-medium" data-rows="16" data-cols="16" data-mines="40">
                    ä¸­çº§
                </button>
                <button class="difficulty-btn flex-1 py-2 px-3 bg-neutral rounded border-2 border-t-white border-l-white border-r-gray-600 border-b-gray-600 hover:bg-gray-300 transition-all duration-150 text-sm font-medium" data-rows="16" data-cols="30" data-mines="99">
                    é«˜çº§
                </button>
            </div>
        </div>
        
        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div class="p-4 bg-gray-300 flex justify-center">
            <div id="game-board" class="grid gap-0.5 select-none"></div>
        </div>
        
        <!-- æ¸¸æˆè¯´æ˜ -->
        <div class="bg-gray-100 p-3 text-xs text-gray-600 border-t-4 border-gray-700">
            <p class="mb-1">
                <i class="fa fa-mouse-pointer mr-1"></i> å·¦é”®ç‚¹å‡»ï¼šç¿»å¼€æ ¼å­
            </p>
            <p>
                <i class="fa fa-hand-pointer-o mr-1"></i> å³é”®ç‚¹å‡»ï¼šæ ‡è®°åœ°é›·
            </p>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            rows: 9,
            cols: 9,
            mines: 10,
            board: [],
            revealed: [],
            flagged: [],
            gameStarted: false,
            gameOver: false,
            win: false,
            minesLeft: 10,
            timer: 0,
            timerInterval: null
        };

        // DOM å…ƒç´ 
        const gameBoard = document.getElementById('game-board');
        const resetBtn = document.getElementById('reset-btn');
        const mineCounter = document.getElementById('mine-counter');
        const timerDisplay = document.getElementById('timer');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame(rows = 9, cols = 9, mines = 10) {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState = {
                rows,
                cols,
                mines,
                board: Array(rows).fill().map(() => Array(cols).fill(0)),
                revealed: Array(rows).fill().map(() => Array(cols).fill(false)),
                flagged: Array(rows).fill().map(() => Array(cols).fill(false)),
                gameStarted: false,
                gameOver: false,
                win: false,
                minesLeft: mines,
                timer: 0,
                timerInterval: null
            };

            // æ¸…ç©ºæ¸¸æˆæ¿
            gameBoard.innerHTML = '';
            gameBoard.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            
            // æ›´æ–°åœ°é›·è®¡æ•°å™¨
            updateMineCounter();
            
            // é‡ç½®è®¡æ—¶å™¨
            clearInterval(gameState.timerInterval);
            timerDisplay.textContent = '000';
            
            // é‡ç½®è¡¨æƒ…æŒ‰é’®
            resetBtn.textContent = 'ğŸ˜Š';
            
            // åˆ›å»ºå•å…ƒæ ¼
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell-unrevealed', 'flex', 'items-center', 'justify-center', 'text-lg', 'font-bold', 'h-8', 'w-8');
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    cell.addEventListener('click', () => handleCellClick(row, col));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(row, col);
                    });
                    
                    gameBoard.appendChild(cell);
                }
            }
        }

        // å¼€å§‹æ¸¸æˆï¼ˆé¦–æ¬¡ç‚¹å‡»åï¼‰
        function startGame(firstRow, firstCol) {
            // ç”Ÿæˆåœ°é›·ï¼Œä½†ä¸åœ¨ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„ä½ç½®åŠå…¶å‘¨å›´
            generateMines(firstRow, firstCol);
            
            // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°
            calculateNumbers();
            
            // æ ‡è®°æ¸¸æˆå·²å¼€å§‹
            gameState.gameStarted = true;
            
            // å¼€å§‹è®¡æ—¶å™¨
            gameState.timerInterval = setInterval(() => {
                if (gameState.timer < 999) {
                    gameState.timer++;
                    timerDisplay.textContent = gameState.timer.toString().padStart(3, '0');
                }
            }, 1000);
            
            // è‡ªåŠ¨ç¿»å¼€ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„æ ¼å­
            revealCell(firstRow, firstCol);
        }

        // ç”Ÿæˆåœ°é›·
        function generateMines(firstRow, firstCol) {
            let minesPlaced = 0;
            
            // åˆ›å»ºå®‰å…¨åŒºåŸŸï¼ˆç¬¬ä¸€æ¬¡ç‚¹å‡»çš„ä½ç½®åŠå…¶å‘¨å›´8ä¸ªæ ¼å­ï¼‰
            const safeZone = [];
            for (let r = Math.max(0, firstRow - 1); r <= Math.min(gameState.rows - 1, firstRow + 1); r++) {
                for (let c = Math.max(0, firstCol - 1); c <= Math.min(gameState.cols - 1, firstCol + 1); c++) {
                    safeZone.push({ row: r, col: c });
                }
            }
            
            // éšæœºæ”¾ç½®åœ°é›·
            while (minesPlaced < gameState.mines) {
                const row = Math.floor(Math.random() * gameState.rows);
                const col = Math.floor(Math.random() * gameState.cols);
                
                // æ£€æŸ¥æ˜¯å¦åœ¨åœ°é›·åŒºä¸”æœªæ”¾ç½®åœ°é›·
                const isInSafeZone = safeZone.some(cell => cell.row === row && cell.col === col);
                if (!isInSafeZone && gameState.board[row][col] !== -1) {
                    gameState.board[row][col] = -1; // -1 è¡¨ç¤ºåœ°é›·
                    minesPlaced++;
                }
            }
        }

        // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°
        function calculateNumbers() {
            for (let row = 0; row < gameState.rows; row++) {
                for (let col = 0; col < gameState.cols; col++) {
                    // å¦‚æœæ˜¯åœ°é›·ï¼Œè·³è¿‡
                    if (gameState.board[row][col] === -1) continue;
                    
                    let count = 0;
                    // æ£€æŸ¥å‘¨å›´çš„8ä¸ªæ ¼å­
                    for (let r = Math.max(0, row - 1); r <= Math.min(gameState.rows - 1, row + 1); r++) {
                        for (let c = Math.max(0, col - 1); c <= Math.min(gameState.cols - 1, col + 1); c++) {
                            if (r === row && c === col) continue; // è·³è¿‡è‡ªèº«
                            if (gameState.board[r][c] === -1) count++;
                        }
                    }
                    
                    gameState.board[row][col] = count;
                }
            }
        }

        // å¤„ç†å·¦é”®ç‚¹å‡»
        function handleCellClick(row, col) {
            // å¦‚æœæ¸¸æˆå·²ç»“æŸæˆ–å·²æ ‡è®°ï¼Œä¸åšå¤„ç†
            if (gameState.gameOver || gameState.flagged[row][col]) return;
            
            // å¦‚æœæ¸¸æˆæœªå¼€å§‹ï¼Œå¼€å§‹æ¸¸æˆ
            if (!gameState.gameStarted) {
                startGame(row, col);
                return;
            }
            
            // ç¿»å¼€æ ¼å­
            revealCell(row, col);
        }

        // å¤„ç†å³é”®ç‚¹å‡»ï¼ˆæ ‡è®°åœ°é›·ï¼‰
        function handleRightClick(row, col) {
            // å¦‚æœæ¸¸æˆå·²ç»“æŸæˆ–å·²ç¿»å¼€ï¼Œä¸åšå¤„ç†
            if (gameState.gameOver || gameState.revealed[row][col]) return;
            
            // å¦‚æœæ¸¸æˆæœªå¼€å§‹ï¼Œé¦–æ¬¡å³é”®ç‚¹å‡»ä¸å¼€å§‹æ¸¸æˆ
            if (!gameState.gameStarted) return;
            
            // åˆ‡æ¢æ ‡è®°çŠ¶æ€
            gameState.flagged[row][col] = !gameState.flagged[row][col];
            
            // æ›´æ–°åœ°é›·è®¡æ•°å™¨
            gameState.minesLeft += gameState.flagged[row][col] ? -1 : 1;
            updateMineCounter();
            
            // æ›´æ–°UI
            updateCellUI(row, col);
            
            // æ£€æŸ¥æ˜¯å¦è·èƒœ
            checkWin();
        }

        // ç¿»å¼€æ ¼å­
        function revealCell(row, col) {
            // å¦‚æœå·²ç¿»å¼€æˆ–å·²æ ‡è®°ï¼Œä¸åšå¤„ç†
            if (gameState.revealed[row][col] || gameState.flagged[row][col]) return;
            
            // æ ‡è®°ä¸ºå·²ç¿»å¼€
            gameState.revealed[row][col] = true;
            
            // æ›´æ–°UI
            updateCellUI(row, col);
            
            // å¦‚æœæ˜¯åœ°é›·ï¼Œæ¸¸æˆç»“æŸ
            if (gameState.board[row][col] === -1) {
                gameOver(false);
                return;
            }
            
            // å¦‚æœå‘¨å›´æ²¡æœ‰åœ°é›·ï¼Œè‡ªåŠ¨ç¿»å¼€å‘¨å›´çš„æ ¼å­
            if (gameState.board[row][col] === 0) {
                for (let r = Math.max(0, row - 1); r <= Math.min(gameState.rows - 1, row + 1); r++) {
                    for (let c = Math.max(0, col - 1); c <= Math.min(gameState.cols - 1, col + 1); c++) {
                        if (r === row && c === col) continue; // è·³è¿‡è‡ªèº«
                        revealCell(r, c);
                    }
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦è·èƒœ
            checkWin();
        }

        // æ›´æ–°å•å…ƒæ ¼UI
        function updateCellUI(row, col) {
            const cell = gameBoard.children[row * gameState.cols + col];
            const cellValue = gameState.board[row][col];
            
            // å¦‚æœå·²ç¿»å¼€
            if (gameState.revealed[row][col]) {
                cell.classList.remove('cell-unrevealed');
                cell.classList.add('cell-revealed');
                
                // æ˜¾ç¤ºåœ°é›·æˆ–æ•°å­—
                if (cellValue === -1) {
                    cell.innerHTML = '<i class="fa fa-bomb text-red-600"></i>';
                } else if (cellValue > 0) {
                    cell.textContent = cellValue;
                    cell.classList.add(`text-${cellValue}`);
                }
            } 
            // å¦‚æœå·²æ ‡è®°
            else if (gameState.flagged[row][col]) {
                cell.innerHTML = '<i class="fa fa-flag text-red-600"></i>';
            }
            // æœªç¿»å¼€ä¸”æœªæ ‡è®°
            else {
                cell.textContent = '';
            }
        }

        // æ›´æ–°åœ°é›·è®¡æ•°å™¨
        function updateMineCounter() {
            // ç¡®ä¿æ˜¾ç¤ºçš„æ•°å­—ä¸å°äº0
            const displayValue = Math.max(0, gameState.minesLeft);
            mineCounter.textContent = displayValue.toString().padStart(3, '0');
        }

        // æ£€æŸ¥æ˜¯å¦è·èƒœ
        function checkWin() {
            // è·èƒœæ¡ä»¶ï¼šæ‰€æœ‰éåœ°é›·æ ¼å­éƒ½å·²ç¿»å¼€
            for (let row = 0; row < gameState.rows; row++) {
                for (let col = 0; col < gameState.cols; col++) {
                    // å¦‚æœæœ‰éåœ°é›·æ ¼å­æœªè¢«ç¿»å¼€ï¼Œæ¸¸æˆæœªç»“æŸ
                    if (!gameState.revealed[row][col] && gameState.board[row][col] !== -1) {
                        return;
                    }
                }
            }
            
            // æ‰€æœ‰éåœ°é›·æ ¼å­éƒ½å·²ç¿»å¼€ï¼Œæ¸¸æˆè·èƒœ
            gameOver(true);
        }

        // æ¸¸æˆç»“æŸ
        function gameOver(isWin) {
            gameState.gameOver = true;
            clearInterval(gameState.timerInterval);
            
            // æ›´æ–°è¡¨æƒ…æŒ‰é’®
            resetBtn.textContent = isWin ? 'ğŸ˜' : 'ğŸ˜µ';
            
            // å¦‚æœè·èƒœï¼Œè‡ªåŠ¨æ ‡è®°æ‰€æœ‰åœ°é›·
            if (isWin) {
                gameState.win = true;
                for (let row = 0; row < gameState.rows; row++) {
                    for (let col = 0; col < gameState.cols; col++) {
                        if (gameState.board[row][col] === -1 && !gameState.flagged[row][col]) {
                            gameState.flagged[row][col] = true;
                            updateCellUI(row, col);
                        }
                    }
                }
            } 
            // å¦‚æœå¤±è´¥ï¼Œæ˜¾ç¤ºæ‰€æœ‰åœ°é›·
            else {
                for (let row = 0; row < gameState.rows; row++) {
                    for (let col = 0; col < gameState.cols; col++) {
                        if (gameState.board[row][col] === -1) {
                            gameState.revealed[row][col] = true;
                            updateCellUI(row, col);
                        } else if (gameState.flagged[row][col]) {
                            // é”™è¯¯æ ‡è®°
                            gameState.revealed[row][col] = true;
                            const cell = gameBoard.children[row * gameState.cols + col];
                            cell.classList.remove('cell-unrevealed');
                            cell.classList.add('cell-revealed');
                            cell.innerHTML = '<i class="fa fa-times text-red-600"></i>';
                        }
                    }
                }
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            initGame(gameState.rows, gameState.cols, gameState.mines);
        }

        // è®¾ç½®éš¾åº¦
        function setDifficulty(rows, cols, mines) {
            initGame(rows, cols, mines);
        }

        // äº‹ä»¶ç›‘å¬
        resetBtn.addEventListener('click', resetGame);
        
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const rows = parseInt(btn.dataset.rows);
                const cols = parseInt(btn.dataset.cols);
                const mines = parseInt(btn.dataset.mines);
                
                // è®¾ç½®æŒ‰é’®æ ·å¼
                difficultyBtns.forEach(b => b.classList.remove('btn-pressed'));
                btn.classList.add('btn-pressed');
                
                setDifficulty(rows, cols, mines);
            });
        });

        // é»˜è®¤é€‰æ‹©åˆçº§éš¾åº¦
        difficultyBtns[0].classList.add('btn-pressed');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
        });
    </script>
    </a>
</body>
</html>
